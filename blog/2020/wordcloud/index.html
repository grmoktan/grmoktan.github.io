<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Fun with word clouds ! | Gautam Raj Moktan</title> <meta name="author" content="Gautam Raj Moktan"> <meta name="description" content="pip install wordcloud"> <meta name="keywords" content="gautam-raj-moktan, grmoktan, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%8E%A9&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://grmoktan.net/blog/2020/wordcloud/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?6185d15ea1982787ad7f435576553d64"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Gautam </span>Raj Moktan</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Fun with word clouds !</h1> <p class="post-meta">April 4, 2020</p> <p class="post-tags"> <a href="/blog/2020"> <i class="fa-solid fa-calendar fa-sm"></i> 2020 </a>   ·   <a href="/blog/tag/wordcloud"> <i class="fa-solid fa-hashtag fa-sm"></i> wordcloud</a>   <a href="/blog/tag/images"> <i class="fa-solid fa-hashtag fa-sm"></i> images</a>   <a href="/blog/tag/python"> <i class="fa-solid fa-hashtag fa-sm"></i> python</a>   <a href="/blog/tag/scraping"> <i class="fa-solid fa-hashtag fa-sm"></i> scraping</a>     ·   <a href="/blog/category/python"> <i class="fa-solid fa-tag fa-sm"></i> python</a>   <a href="/blog/category/code"> <i class="fa-solid fa-tag fa-sm"></i> code</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>I had made word clouds on Tableau before. Recently stumbled upon a <a href="https://pypi.org/project/wordcloud/" rel="external nofollow noopener" target="_blank">python package</a> for it.</p> <p>Wanted to play with it, thus quickly hit <code class="language-plaintext highlighter-rouge">pip install wordcloud</code> in my virtualenv. Looking at the examples, I thought perhaps I could contrast texts of two different subjects. Suppose I want to contrast word cloud of Finland (where I live) and Nepal (where I am from). Comparing countries seems like a good candidate as I could use the country map as masks even. I needed some input texts first though.</p> <p>I would get the word cloud input text from the Wikipedia page about each country. Mediawiki provides a nice API to extract the text. I pulled the whole page’s html and used beautifulsoup to parse the html and extract corresponding text. Wrote a small function for it:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="n">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="k">def</span> <span class="nf">get_wikitext</span><span class="p">(</span><span class="n">page_title</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    API: https://www.mediawiki.org/wiki/API:Parsing_wikitext
    Example Usage:
    print(get_wikitext(</span><span class="sh">'</span><span class="s">Nepal</span><span class="sh">'</span><span class="s">))
    </span><span class="sh">"""</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nc">Session</span><span class="p">()</span>
    <span class="n">URL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://en.wikipedia.org/w/api.php</span><span class="sh">"</span>

    <span class="n">PARAMS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">action</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">parse</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">page</span><span class="sh">"</span><span class="p">:</span> <span class="n">page_title</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">format</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">json</span><span class="sh">"</span>
    <span class="p">}</span>
</code></pre></div></div> <p>So now my input texts are automated with <code class="language-plaintext highlighter-rouge">get_wikitext()</code> function. For example, <code class="language-plaintext highlighter-rouge">get_wikitext('Nepal')</code> outputs a string beginning with “This article is about the country. For other uses, see …”</p> <blockquote> In general, texts have a lot of words that we do not want to see in the word cloud. </blockquote> <p>Such “Stop words” can be filtered out. Convenienty, this worcloud package provides a builtin set already covering the ususal suspects. I added in a few more that I did not want to see.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">wordcloud</span> <span class="kn">import</span> <span class="n">STOPWORDS</span> 
<span class="n">stopwords</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">STOPWORDS</span><span class="p">).</span><span class="nf">union</span><span class="p">(</span><span class="nf">set</span><span class="p">([</span><span class="sh">'</span><span class="s">article</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">main</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">retrieved</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">archived</span><span class="sh">'</span><span class="p">,</span> 
                                <span class="sh">'</span><span class="s">parser</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">original</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">citation</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">parser</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mw</span><span class="sh">'</span><span class="p">,</span>
                                <span class="sh">'</span><span class="s">output</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">edit</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Monday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Tuesday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Wednesday</span><span class="sh">'</span><span class="p">,</span> 
                                <span class="sh">'</span><span class="s">Thursday</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Friday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Saturday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Sunday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">January</span><span class="sh">'</span><span class="p">,</span> 
                                <span class="sh">'</span><span class="s">February</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">March</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">April</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">May</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">June</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">July</span><span class="sh">'</span><span class="p">,</span> 
                                <span class="sh">'</span><span class="s">August</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">September</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">October</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">November</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">December</span><span class="sh">'</span><span class="p">]</span>
                                <span class="p">))</span>
</code></pre></div></div> <p>Then generating the word clouds was quite straight forward.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span>

<span class="n">np_txt</span><span class="o">=</span> <span class="nf">get_wikitext</span><span class="p">(</span><span class="sh">'</span><span class="s">Nepal</span><span class="sh">'</span><span class="p">)</span>
<span class="n">fi_txt</span><span class="o">=</span> <span class="nf">get_wikitext</span><span class="p">(</span><span class="sh">'</span><span class="s">Finland</span><span class="sh">'</span><span class="p">)</span>

<span class="n">wcloud_np</span> <span class="o">=</span> <span class="nc">WordCloud</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span> 
                <span class="n">background_color</span> <span class="o">=</span><span class="sh">'</span><span class="s">yellow</span><span class="sh">'</span><span class="p">,</span> 
                <span class="n">stopwords</span> <span class="o">=</span> <span class="n">stopwords</span> <span class="p">,</span> 
                <span class="n">min_font_size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">).</span><span class="nf">generate</span><span class="p">(</span><span class="n">np_txt</span><span class="p">)</span> 

<span class="n">wcloud_fi</span> <span class="o">=</span> <span class="nc">WordCloud</span><span class="p">(</span><span class="n">width</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span> 
                <span class="n">background_color</span> <span class="o">=</span><span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> 
                <span class="n">stopwords</span> <span class="o">=</span> <span class="n">stopwords</span> <span class="p">,</span> 
                <span class="n">min_font_size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">).</span><span class="nf">generate</span><span class="p">(</span><span class="n">fi_txt</span><span class="p">)</span> 
</code></pre></div></div> <p>And plotting them side by side using matplotlib (Note that the background colour is already specified above. I took the hex color code of the flag’s primary color).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">wcloud_np</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">axis</span><span class="p">(</span><span class="sh">"</span><span class="s">off</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">wcloud_fi</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">axis</span><span class="p">(</span><span class="sh">"</span><span class="s">off</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">(</span><span class="n">pad</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> 
</code></pre></div></div> <p>Result:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/word_cloud_1-480.webp 480w, /assets/img/word_cloud_1-800.webp 800w, /assets/img/word_cloud_1-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/word_cloud_1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Next was to try the mask the word clouds. I uploaded some google images of the country map to <a href="http://www.photo2stencil.com/" rel="external nofollow noopener" target="_blank">photo2stencil.com</a> and obtained their .png files. Then, using <code class="language-plaintext highlighter-rouge">pillow</code> and <code class="language-plaintext highlighter-rouge">numpy</code> the mask was created. Some images would need to be preprocessed (e.g. background values setting to 255 or converting 3D image to 2D).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">os</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="n">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span><span class="p">,</span> <span class="n">STOPWORDS</span>

<span class="k">def</span> <span class="nf">transform_format</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">255</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">val</span>

<span class="k">def</span> <span class="nf">clean_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">mask</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">.</span><span class="nf">reshape</span><span class="p">((</span><span class="n">mask</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="sh">'</span><span class="s">F</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">new_mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">ndarray</span><span class="p">((</span><span class="n">mask</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mask</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="p">.</span><span class="n">int32</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)):</span>
        <span class="n">new_mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">map</span><span class="p">(</span><span class="n">transform_format</span><span class="p">,</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">new_mask</span><span class="p">[:,:</span><span class="n">x</span><span class="p">]</span>

<span class="n">np_mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">images/np_mask.png</span><span class="sh">"</span><span class="p">))</span>
<span class="n">fi_mask</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">images/fi_mask.png</span><span class="sh">"</span><span class="p">))</span>

<span class="n">t_np_mask</span> <span class="o">=</span> <span class="nf">clean_mask</span><span class="p">(</span><span class="n">np_mask</span><span class="p">)</span>
<span class="n">t_fi_mask</span> <span class="o">=</span> <span class="nf">clean_mask</span><span class="p">(</span><span class="n">fi_mask</span><span class="p">)</span>

<span class="n">wc1</span> <span class="o">=</span>  <span class="nc">WordCloud</span><span class="p">(</span><span class="n">background_color</span><span class="o">=</span><span class="sh">"</span><span class="s">white</span><span class="sh">"</span><span class="p">,</span> 
                 <span class="n">max_words</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> 
                 <span class="n">mask</span><span class="o">=</span><span class="n">t_np_mask</span><span class="p">,</span>
                 <span class="n">stopwords</span><span class="o">=</span><span class="n">stopwords</span><span class="p">,</span> 
                 <span class="n">contour_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                 <span class="n">contour_color</span><span class="o">=</span><span class="sh">'</span><span class="s">#DC143C</span><span class="sh">'</span><span class="p">).</span><span class="nf">generate</span><span class="p">(</span><span class="n">np_txt</span><span class="p">)</span>

<span class="n">wc2</span> <span class="o">=</span>  <span class="nc">WordCloud</span><span class="p">(</span><span class="n">background_color</span><span class="o">=</span><span class="sh">"</span><span class="s">white</span><span class="sh">"</span><span class="p">,</span> 
                 <span class="n">max_words</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> 
                 <span class="n">mask</span><span class="o">=</span><span class="n">t_fi_mask</span><span class="p">,</span>
                 <span class="n">stopwords</span><span class="o">=</span><span class="n">stopwords</span><span class="p">,</span> 
                 <span class="n">contour_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                 <span class="n">contour_color</span><span class="o">=</span><span class="sh">"</span><span class="s">#002F6C</span><span class="sh">"</span><span class="p">).</span><span class="nf">generate</span><span class="p">(</span><span class="n">fi_txt</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">wc1</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">axis</span><span class="p">(</span><span class="sh">"</span><span class="s">off</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">wc2</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">axis</span><span class="p">(</span><span class="sh">"</span><span class="s">off</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">(</span><span class="n">pad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> 
</code></pre></div></div> <p>Result:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/word_cloud_2-480.webp 480w, /assets/img/word_cloud_2-800.webp 800w, /assets/img/word_cloud_2-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/word_cloud_2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>And similarly, each county’s national bird’s description is used to create the word clouds below. The word cloud is recolored using their color in the image used. Also edges are identified and made distinct.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">from</span> <span class="n">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="n">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_gradient_magnitude</span>
<span class="kn">from</span> <span class="n">wordcloud</span> <span class="kn">import</span> <span class="n">WordCloud</span><span class="p">,</span> <span class="n">ImageColorGenerator</span><span class="p">,</span> <span class="n">STOPWORDS</span>

<span class="k">def</span> <span class="nf">get_wc</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">color</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
    <span class="n">mask</span><span class="p">[</span><span class="n">mask</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">([</span><span class="nf">gaussian_gradient_magnitude</span><span class="p">(</span><span class="n">color</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mask</span><span class="p">[</span><span class="n">edges</span> <span class="o">&gt;</span> <span class="p">.</span><span class="mi">08</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
    <span class="n">stopwords</span> <span class="o">=</span> <span class="nf">set</span><span class="p">(</span><span class="n">STOPWORDS</span><span class="p">).</span><span class="nf">union</span><span class="p">(</span><span class="nf">set</span><span class="p">([</span><span class="sh">'</span><span class="s">article</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">main</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">retrieved</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">archived</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">parser</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">original</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">citation</span><span class="sh">'</span><span class="p">,</span>
                                          <span class="sh">'</span><span class="s">parser</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">mw</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">output</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">edit</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Monday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Tuesday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Wednesday</span><span class="sh">'</span><span class="p">,</span> 
                                          <span class="sh">'</span><span class="s">Thursday</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">Friday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Saturday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Sunday</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">January</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">February</span><span class="sh">'</span><span class="p">,</span> 
                                          <span class="sh">'</span><span class="s">March</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">April</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">May</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">June</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">July</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">August</span><span class="sh">'</span><span class="p">,</span><span class="sh">'</span><span class="s">September</span><span class="sh">'</span><span class="p">,</span> 
                                          <span class="sh">'</span><span class="s">October</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">November</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">December</span><span class="sh">'</span><span class="p">]))</span>


    <span class="n">wc</span> <span class="o">=</span> <span class="nc">WordCloud</span><span class="p">(</span><span class="n">background_color</span><span class="o">=</span><span class="sh">"</span><span class="s">black</span><span class="sh">"</span><span class="p">,</span> 
                   <span class="n">max_words</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                   <span class="n">stopwords</span><span class="o">=</span><span class="n">stopwords</span><span class="p">,</span> 
                   <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> 
                   <span class="n">max_font_size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> 
                   <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> 
                   <span class="n">relative_scaling</span><span class="o">=</span><span class="mf">0.1</span><span class="p">).</span><span class="nf">generate</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="n">image_colors</span> <span class="o">=</span> <span class="nc">ImageColorGenerator</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
    <span class="n">wc</span><span class="p">.</span><span class="nf">recolor</span><span class="p">(</span><span class="n">color_func</span><span class="o">=</span><span class="n">image_colors</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wc</span>


<span class="n">np_bird</span><span class="o">=</span><span class="nf">get_wikitext</span><span class="p">(</span><span class="sh">'</span><span class="s">Himalayan_monal</span><span class="sh">'</span><span class="p">)</span>
<span class="n">fi_bird</span><span class="o">=</span><span class="nf">get_wikitext</span><span class="p">(</span><span class="sh">'</span><span class="s">Whooper_swan</span><span class="sh">'</span><span class="p">)</span>

<span class="n">danphe_color</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">images/danphe.jpg</span><span class="sh">"</span><span class="p">))</span>
<span class="n">wc1</span> <span class="o">=</span> <span class="nf">get_wc</span><span class="p">(</span><span class="n">danphe_color</span><span class="p">,</span> <span class="n">np_bird</span><span class="p">)</span>
<span class="n">swan_color</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">Image</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="sh">"</span><span class="s">images/swan.jpg</span><span class="sh">"</span><span class="p">))</span>
<span class="n">wc2</span> <span class="o">=</span> <span class="nf">get_wc</span><span class="p">(</span><span class="n">swan_color</span><span class="p">,</span> <span class="n">fi_bird</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">wc1</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="sh">"</span><span class="s">bilinear</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">wc2</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="sh">"</span><span class="s">bilinear</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">(</span><span class="n">pad</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">danphe_color</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">swan_color</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">axis</span><span class="p">(</span><span class="sh">"</span><span class="s">off</span><span class="sh">"</span><span class="p">)</span> 
<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">(</span><span class="n">pad</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> 
</code></pre></div></div> <p>Result:</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/word_cloud_3a-480.webp 480w, /assets/img/word_cloud_3a-800.webp 800w, /assets/img/word_cloud_3a-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/word_cloud_3a.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/word_cloud_3b-480.webp 480w, /assets/img/word_cloud_3b-800.webp 800w, /assets/img/word_cloud_3b-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/word_cloud_3b.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>So maybe I need to select the images more carefully for the word clouds to pop out. All in all, this was a pretty fun exercise. I look forward to find use of this in other projects :) .</p> <p>[Update:] I ended up using this method to generate the cover art of <a href="http://urn.fi/URN:ISBN:978-952-60-3983-1" rel="external nofollow noopener" target="_blank">my doctoral dissertation!</a>. Fed the whole dissertation text into an image of a 3d Pie Chart :) :</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset=" /assets/img/dissertation-480.webp 480w, /assets/img/dissertation-800.webp 800w, /assets/img/dissertation-1400.webp 1400w, " sizes="95vw" type="image/webp"></source> <img src="/assets/img/dissertation.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2013/beat-that-dhindo/">Beat that "Dhindo"!</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2008/mero-behosi-aaja/">Mero Behosi Aaja ...</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2020/interactive-plotly/">Interactive charts on a static page</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2011/thukpa-recipe/">Ustaad ko Thukpa Recipe!!</a> </li> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> © Copyright 2024 Gautam Raj Moktan. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?d633890033921b33e0ceb13d22340a9c"></script> <script defer src="/assets/js/common.js?acdb9690d7641b2f8d40529018c71a01"></script> <script defer src="/assets/js/copy_code.js?9b43d6e67ddc7c0855b1478ee4c48c2d" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-2DXR6E41VN"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-2DXR6E41VN");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>